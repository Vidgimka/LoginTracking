Готовые исправлений:
1) КАждый раз на каждый запрос создавать новое соедниенеие к бд нельзя
Это очень медленно и соединения закончатс,Их надо закрывать.
2) Нужно в создать его только раз в main
и везде испольльзовать для запросов передавая по указателю

Исправленияв доработке:
1) И ошибки нужно обрабатывать, Ты нигде не обрабатываешь